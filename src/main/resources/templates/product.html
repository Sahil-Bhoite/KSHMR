<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{base::layout(~{::section})}">

<head>
    <meta charset="UTF-8">
    <title>KSHMR - Collection</title>
</head>

<body>
    <section>
        <!-- Header -->
        <div class="bg-secondary py-5 mt-5">
            <div class="container container-custom pt-5">
                <div class="row align-items-end">
                    <div class="col-md-6">
                        <span class="text-uppercase letter-spacing-2 small text-muted mb-2 d-block">Shop</span>
                        <h1 class="display-4 mb-0 font-heading" th:if="${paramValue==''}">All Products</h1>
                        <h1 class="display-4 mb-0 font-heading" th:unless="${paramValue==''}">[[${paramValue}]]</h1>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <p class="text-muted mb-0">Showing [[${totalElements}]] curated items</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="container container-custom py-5">
            <div class="row g-5">
                <!-- Sidebar Filters (Minimal) -->
                <div class="col-lg-3">
                    <div class="sticky-top" style="top: 100px;">
                        <div class="mb-5">
                            <h6 class="text-uppercase letter-spacing-1 small fw-bold mb-3 text-sapphire">Categories</h6>
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <a href="/products" class="text-decoration-none transition-normal"
                                        th:classappend="${paramValue==''} ? 'text-dark fw-bold' : 'text-muted hover-text-dark'">
                                        All Collection
                                    </a>
                                </li>
                                <li class="mb-2" th:each="c:${categories}">
                                    <a th:href="@{'/products?category='+${c.name}}"
                                        class="text-decoration-none transition-normal"
                                        th:classappend="${paramValue==c.name} ? 'text-dark fw-bold' : 'text-muted hover-text-dark'">
                                        [[${c.name}]]
                                    </a>
                                </li>
                            </ul>
                        </div>

                        <!-- Search (Minimal) -->
                        <div class="mb-5">
                            <h6 class="text-uppercase letter-spacing-1 small fw-bold mb-3 text-sapphire">Search</h6>
                            <form action="/products" method="get">
                                <div class="input-group border-bottom">
                                    <input type="text" class="form-control border-0 bg-transparent p-0 shadow-none"
                                        name="ch" placeholder="Type to search...">
                                    <button class="btn btn-link text-dark p-0 border-0" type="submit"><i
                                            class="fa-solid fa-arrow-right"></i></button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Product Grid -->
                <div class="col-lg-9">
                    <div class="row g-4">
                        <div class="col-md-4 col-6" th:each="p:${products}">
                            <div class="card card-product h-100">
                                <div class="product-img-wrapper mb-3 bg-secondary">
                                    <img th:src="@{'/img/'+${p.image}}" class="img-fluid p-4" alt="Product">
                                    <a th:href="@{'/product/'+${p.id}}" class="quick-view-btn">View Details</a>

                                    <span
                                        class="position-absolute top-0 start-0 m-3 badge bg-white text-dark rounded-0 shadow-sm text-uppercase letter-spacing-1"
                                        style="font-size: 0.6rem;" th:if="${p.discount > 0}">-[[${p.discount}]]%</span>
                                </div>
                                <div class="text-center">
                                    <div class="text-muted small text-uppercase letter-spacing-1 mb-1">[[${p.category}]]
                                    </div>
                                    <h5 class="mb-2 font-body fw-medium fs-6 text-truncate px-2">
                                        <a th:href="@{'/product/'+${p.id}}" class="text-reset">[[${p.title}]]</a>
                                    </h5>
                                    <div class="text-sapphire fw-bold">
                                        <span th:if="${p.discountPrice != null && p.discountPrice < p.price}">
                                            &#8377;[[${p.discountPrice}]] <s
                                                class="text-muted ms-2 small fw-normal">&#8377;[[${p.price}]]</s>
                                        </span>
                                        <span th:unless="${p.discountPrice != null && p.discountPrice < p.price}">
                                            &#8377;[[${p.price}]]
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- No Products Found -->
                        <div class="col-12 text-center py-5" th:if="${productsSize==0}">
                            <p class="text-muted">No products found matching your criteria.</p>
                            <a href="/products" class="btn btn-outline-dark btn-sm">Clear Filters</a>
                        </div>
                    </div>

                    <!-- Pagination (Minimal) -->
                    <div class="row mt-5" th:if="${productsSize>0}">
                        <div class="col-12 d-flex justify-content-center">
                            <nav aria-label="Page navigation">
                                <ul class="pagination">
                                    <li class="page-item" th:classappend="${isFirst} ? 'disabled':''">
                                        <a class="page-link border-0 bg-transparent text-muted"
                                            th:href="@{'/products?pageNo='+${pageNo-1}}" aria-label="Previous">
                                            <span aria-hidden="true">&laquo; Prev</span>
                                        </a>
                                    </li>
                                    <li class="page-item" th:each="i:${#numbers.sequence(1,totalPages)}"
                                        th:classappend="${pageNo+1==i}?'active':''">
                                        <a class="page-link border-0 bg-transparent"
                                            th:classappend="${pageNo+1==i}?'text-dark fw-bold border-bottom border-dark rounded-0':'text-muted'"
                                            th:href="@{'/products?pageNo='+${i-1}}">[[${i}]]</a>
                                    </li>
                                    <li class="page-item" th:classappend="${isLast} ? 'disabled':''">
                                        <a class="page-link border-0 bg-transparent text-muted"
                                            th:href="@{'/products?pageNo='+${pageNo+1}}" aria-label="Next">
                                            <span aria-hidden="true">Next &raquo;</span>
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <style>
            .hover-text-dark:hover {
                color: var(--color-text-primary) !important;
            }
        </style>
    </section>
</body>

</html>